import numpy as np
import pandas as pd

df = pd.read_csv("cleaned_research_audio_data.csv")
df.head()

df.info()

df = df.drop(columns=['duration_use_hours'])  
df.head()

nc_map = {
    'No': 0,
    'Yes': 1,
    'Sometimes': 2
}
df['noise_cancellation_ord'] = df['noise_cancellation'].map(nc_map)
df.head()

// map()- When converting categories to numbers
// replace()- When fixing text or typos

// create binary environment columns
df['env_quiet'] = df['listening_environment'].str.contains('Quiet', case=False, na=False).astype(int)
df['env_busy'] = df['listening_environment'].str.contains('Busy', case=False, na=False).astype(int)
df['env_noisy'] = df['listening_environment'].str.contains('Noisy', case=False, na=False).astype(int)
df['env_workspace'] = df['listening_environment'].str.contains('Workspace', case=False, na=False).astype(int)
df['env_recreational'] = df['listening_environment'].str.contains('Recreational', case=False, na=False).astype(int)

// case=False - not case sensitive
// na=False - if value missing, treat it as false, no crash code
// id string contains then int value  

df = df.drop(columns=['listening_environment'])
df.columns

df['APS_score'] = df[
    [
        'aps_task_completion_on_time',
        'aps_assignment_management',
        'aps_productivity_in_noise',
        'aps_goal_achievement',
        'aps_headphones_productivity',
        'aps_distraction_task_delay_rev'
    ]
].mean(axis=1)

df['ACS_score'] = df[
    [
        'acs_focus_ability',
        'acs_attention_shifting',
        'acs_refocus_after_distraction',
        'acs_ignore_distractions',
        'acs_single_task_concentration',
        'acs_concentration_disrupted_rev',
        'acs_noise_concentration_difficulty_rev',
        'acs_sustained_attention_difficulty_rev',
        'acs_daydreaming_rev',
        'acs_headphones_focus_loss_rev'
    ]
].mean(axis=1)

df['APS_score'] = df['APS_score'].round(2)
df['ACS_score'] = df['ACS_score'].round(2)

df[['APS_score','ACS_score']].describe()

df.to_csv("final_audio_analysis_ready.csv", index=False)

!python -m pip install pyodbc sqlalchemy

import pyodbc
import sqlalchemy
print("pyodbc OK")
print("sqlalchemy OK")

import pandas as pd
from sqlalchemy import create_engine
server = r"LAPTOP-6OM1UJPG\SQLEXPRESS"    # e.g. DESKTOP-XXXX\SQLEXPRESS
database = 'master'
engine = create_engine(
    f"mssql+pyodbc://@{server}/{database}?driver=ODBC+Driver+17+for+SQL+Server"
)
print("Connected to SQL Server!")

from sqlalchemy import create_engine
import pandas as pd
server = r"LAPTOP-6OM1UJPG\SQLEXPRESS"
database = "AudioResearchDB"
engine = create_engine(
    f"mssql+pyodbc://@{server}/{database}?driver=ODBC+Driver+17+for+SQL+Server"
)

data = pd.read_csv("final_audio_analysis_ready.csv")

data.to_sql(
    name="audio_study_data",
    con=engine,
    if_exists="replace",   # safe for first time
    index=False
)

pd.read_sql("SELECT TOP 10 * FROM audio_study_data", engine)

pd.read_sql("SELECT COUNT(*) AS total_rows FROM audio_study_data", engine)
